<!DOCTYPE html>
<html lang="en">
    <head prefix="og: http://ogp.me/ns#">
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="application-name" content="Mousehole" />
  <meta name="apple-mobile-web-app-status-bar-style" content="#fff" />
  <meta name="apple-mobile-web-app-title" content="Mousehole" />
  <title>
  Important considerations for a future package manager - Mousehole
  </title>
  <link rel="alternate" href="https://dirout.github.io/blog/posts/2021/07/06/important-considerations-for-a-future-package-manager/" hreflang="en" />
  <link rel="canonical" href="https://dirout.github.io/blog/posts/2021/07/06/important-considerations-for-a-future-package-manager/" />
  <meta name="description"  content="Musings from the mice"  />
  <meta name="referrer" content="no-referrer-when-downgrade" />
  <meta property="og:site_name" content="Important considerations for a future package manager | Em Sayahi " />
  <meta property="og:title" content="Important considerations for a future package manager | Em Sayahi" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://dirout.github.io/blog/posts/2021/07/06/important-considerations-for-a-future-package-manager/" />
  <meta property="og:description"  content="Musings from the mice"  />
  
  <meta property="og:image" content="https://dirout.github.io/blog/assets/img/ogp.png" />
  
  <meta property="og:image:width" content="640" />
  <meta property="og:image:height" content="640" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Important considerations for a future package manager | Em Sayahi" />
  <meta name="twitter:url" content="https://dirout.github.io/blog/posts/2021/07/06/important-considerations-for-a-future-package-manager/" />
  <meta name="twitter:site" content="Mousehole" />
  <meta name="twitter:creator" content="Em Sayahi" />
  <meta name="twitter:description" content="Musings from the mice"  />
  
  <meta name="twitter:image" content="https://dirout.github.io/blog/assets/img/ogp.png" />
  
  <link rel="apple-touch-icon" sizes="180x180" href="https://dirout.github.io/blog/assets/favicons/apple-touch-icon.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://dirout.github.io/blog/assets/favicons/favicon-32x32.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="https://dirout.github.io/blog/assets/favicons/favicon-16x16.png" />
  <link rel="mask-icon" href="https://dirout.github.io/blog/assets/favicons/safari-pinned-tab.svg" color="#5bbad5" />
  <meta name="apple-mobile-web-app-title" content="Mousehole" />
  <meta name="application-name" content="Mousehole" />
  <meta name="msapplication-TileColor" content="#da532c" />
  <meta name="theme-color" content="#2c2c2c" />
  <link rel="stylesheet" href="https://dirout.github.io/blog/assets/css/style.css" />
</head>


    <body data-theme="dark" class="notransition">
        <script>
            const body = document.body;
            const data = body.getAttribute("data-theme");

            const initTheme = (state) => {
                if (state === "dark") {
                    body.setAttribute("data-theme", "dark");
                } else if (state === "light") {
                    body.removeAttribute("data-theme");
                } else {
                    localStorage.setItem("theme", data);
                }
            };

            initTheme(localStorage.getItem("theme"));

            setTimeout(() => body.classList.remove("notransition"), 75);
        </script>

        <div class="navbar" role="navigation">
  <nav class="menu">
    <input type="checkbox" id="menu-trigger" class="menu-trigger" />
    <label for="menu-trigger">
      <span class="menu-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 512 512"
        >
          <path
            d="M64,384H448V341.33H64Zm0-106.67H448V234.67H64ZM64,128v42.67H448V128Z"
          />
        </svg>
      </span>
    </label>
    <a id="mode">
      <svg
        class="mode-sunny"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 512 512"
      >
        <title>Day</title>
        <line
          x1="256"
          y1="48"
          x2="256"
          y2="96"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="256"
          y1="416"
          x2="256"
          y2="464"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="403.08"
          y1="108.92"
          x2="369.14"
          y2="142.86"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="142.86"
          y1="369.14"
          x2="108.92"
          y2="403.08"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="464"
          y1="256"
          x2="416"
          y2="256"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="96"
          y1="256"
          x2="48"
          y2="256"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="403.08"
          y1="403.08"
          x2="369.14"
          y2="369.14"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="142.86"
          y1="142.86"
          x2="108.92"
          y2="108.92"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <circle
          cx="256"
          cy="256"
          r="80"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
      </svg>
      <svg
        class="mode-moon"
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 512 512"
      >
        <title>Night</title>
        <line
          x1="256"
          y1="48"
          x2="256"
          y2="96"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="256"
          y1="416"
          x2="256"
          y2="464"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="403.08"
          y1="108.92"
          x2="369.14"
          y2="142.86"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="142.86"
          y1="369.14"
          x2="108.92"
          y2="403.08"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="464"
          y1="256"
          x2="416"
          y2="256"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="96"
          y1="256"
          x2="48"
          y2="256"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="403.08"
          y1="403.08"
          x2="369.14"
          y2="369.14"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <line
          x1="142.86"
          y1="142.86"
          x2="108.92"
          y2="108.92"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
        <circle
          cx="256"
          cy="256"
          r="80"
          style="stroke-linecap:round;stroke-miterlimit:10;stroke-width:32px"
        />
      </svg>
    </a>
    <div class="trigger">
      <div class="trigger-container"><a class="menu-link" href="https://dirout.github.io/blog/">home</a><a class="menu-link" href="https://dirout.github.io/blog/archive">archive</a><a class="menu-link" href="https://dirout.github.io/blog/about">about</a><a class="menu-link rss" href="https://dirout.github.io/blog/feed.xml">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="17"
            height="17"
            viewBox="0 0 512 512"
            fill="#ED812E"
          >
            <title>RSS</title>
            <path
              d="M108.56,342.78a60.34,60.34,0,1,0,60.56,60.44A60.63,60.63,0,0,0,108.56,342.78Z"
            />
            <path
              d="M48,186.67v86.55c52,0,101.94,15.39,138.67,52.11s52,86.56,52,138.67h86.66C325.33,312.44,199.67,186.67,48,186.67Z"
            />
            <path
              d="M48,48v86.56c185.25,0,329.22,144.08,329.22,329.44H464C464,234.66,277.67,48,48,48Z"
            />
          </svg>
        </a>
      </div>
    </div>
  </nav>
</div>

        <div class="wrapper post">
            <main class="page-content" aria-label="Content">
                <article itemscope itemtype="https://schema.org/BlogPosting">
                    <header class="header">
                        
                        <div class="tags">
                            
                            <span itemprop="keywords">
                                
                                <a class="tag" href="https://dirout.github.io/blog/tags#micro">MICRO</a>, 
                                <a class="tag" href="https://dirout.github.io/blog/tags#ramble">RAMBLE</a> 
                            </span>
                        </div>
                        
                        <h1 class="header-title" itemprop="headline">Important considerations for a future package manager</h1>
                        
                        <div class="post-meta">
                            <time datetime="2021-07-06T23:53:00+00:00" itemprop="datePublished">
                                6 July 2021
                            </time>
                            <span itemprop="author" itemscope itemtype="https://schema.org/Person">
                                <span itemprop="name">Em Sayahi</span>
                            </span>
                            
                            <span hidden itemprop="publisher" itemtype="Person">Em Sayahi</span>
                            
                            <span hidden itemprop="mainEntityOfPage"><hr />
<h4>A foreword</h4>
<p>This is my initial draft of <a href="https://github.com/Dirout/gany/discussions/5#discussion-3448930">a GitHub discussion</a> concerning what a future system package manager would look like. If you’re considering writing your own, I highly urge you read &amp; consider what I have to say</p>
<hr />
<h2>Vocabulary</h2>
<ul>
<li>Package — a unit of shared software</li>
<li>Repository — a collection of packaged software</li>
<li>Distribution — a repository of software which is distributed to others</li>
</ul>
<h2>Concepts</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Delta_encoding">Delta encoding</a> — updating data by getting only the differences, as opposed to retrieving a whole new copy of a file
<ul>
<li>Updating a package’s local data from a remote repository would use less bandwidth with this technique</li>
</ul>
</li>
<li>Multi-versioned packages — dropping <a href="https://research.swtch.com/version-sat">the assumption that only one version of a package may be installed at once</a>, minimising <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency hell</a></li>
<li>Separation of package metadata — if a package does not come bundled with its own metadata, then getting a package’s information from a remote source will not require downloading a package itself
<ul>
<li>Additionally, the file size of the package itself will be reduced</li>
</ul>
</li>
<li>Separate hierarchies &amp; exchange directories — packages are separated from the rest of the file system, which will create less clutter and sources of conflict (such as from two packages providing a file with the same path and name)
<ul>
<li>Exchange directories may be global (such as <code>share</code>), so as to maintain compatibility with the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>, or inter-package, for situations where one package may act as a plugin for another one</li>
<li>A separate hierarchy for packages will also ensure that a user’s kernel &amp; userland remains untouched, reducing the risk of system failure</li>
</ul>
</li>
<li><a href="http://ftp.rpm.org/max-rpm/s1-rpm-inside-files-list-directives.html#S3-RPM-INSIDE-FLIST-GHOST-DIRECTIVE">Ghost files</a> — software often produces files during its use, such as log files, state files, index files, and the sort. Such files should remain associated with the software’s package so they can be removed along with the rest of the software</li>
</ul>
<h2>Considerations</h2>
<ul>
<li>Hooks and triggers
<ul>
<li>Without hooks or triggers, <a href="https://michael.stapelberg.ch/posts/2019-07-20-hooks-and-triggers/#hooks-preclude-concurrent-package-installation">concurrent package installation becomes much more possible</a>. Several major package managers <a href="https://michael.stapelberg.ch/posts/2019-08-17-linux-package-managers-are-slow/#current-landscape">only use post-install hooks</a>, and those can be <a href="https://src.fedoraproject.org/rpms/openssh/blob/30922f629cc135e3233e263d5e3eb346f9251c4e/f/sshd-keygen%40.service">replaced with services</a></li>
<li>While many would object to leaning on configuring an initialisation system instead of using hooks, particularly when many object with <code>systemd</code> as a whole (often due to its association with Lennart Poettering and <a href="http://0pointer.net/blog/revisiting-how-we-put-together-linux-systems.html">the philosophies of the <code>systemd</code> ‘cabal’ in general</a>), I must say that I largely agree with them—quite frankly, I don’t give a damn about how you (wrongly) feel about <code>systemd</code> being ‘bloated’ because the user experience will be improved by relying on it. If the notion of a system daemon scares you, then I don’t know how to even begin to approach you; unless you’re worried about some <a href="https://wiki.c2.com/?TheKenThompsonHack">Ken Thompson Bug</a>-type scenario where <code>systemd</code> could be exploited, then you cannot be arguing in good faith</li>
</ul>
</li>
<li>Archives or Images?
<ul>
<li>The best contender for an image format would be <a href="https://en.wikipedia.org/wiki/SquashFS">SquashFS</a>. Snap packages utilise it, and they <a href="https://forum.snapcraft.io/t/squashfs-performance-effect-on-snap-startup-time/13920">come with a decent performance hit</a>. While <a href="https://michael.stapelberg.ch/posts/2019-08-17-linux-package-managers-are-slow/#thought-experiment-further-speed-ups">using an archive would make package installation faster</a>, at the end of the day the user is going to care more about their system running slow than whether or not their packages install a tad bit faster</li>
<li>The <a href="https://en.wikipedia.org/wiki/LZ4_(compression_algorithm)">LZ4 algorithm</a> would provide the fastest decompression speeds available, ensuring the lowest decompression times possible during installation while also not sacrificing on the runtime performance of packaged software</li>
</ul>
</li>
</ul>
</span>
                        </div>
                        
                    </header>

                    <div class="page-content" itemprop="articleBody">
                        <hr />
<h4>A foreword</h4>
<p>This is my initial draft of <a href="https://github.com/Dirout/gany/discussions/5#discussion-3448930">a GitHub discussion</a> concerning what a future system package manager would look like. If you’re considering writing your own, I highly urge you read &amp; consider what I have to say</p>
<hr />
<h2>Vocabulary</h2>
<ul>
<li>Package — a unit of shared software</li>
<li>Repository — a collection of packaged software</li>
<li>Distribution — a repository of software which is distributed to others</li>
</ul>
<h2>Concepts</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Delta_encoding">Delta encoding</a> — updating data by getting only the differences, as opposed to retrieving a whole new copy of a file
<ul>
<li>Updating a package’s local data from a remote repository would use less bandwidth with this technique</li>
</ul>
</li>
<li>Multi-versioned packages — dropping <a href="https://research.swtch.com/version-sat">the assumption that only one version of a package may be installed at once</a>, minimising <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency hell</a></li>
<li>Separation of package metadata — if a package does not come bundled with its own metadata, then getting a package’s information from a remote source will not require downloading a package itself
<ul>
<li>Additionally, the file size of the package itself will be reduced</li>
</ul>
</li>
<li>Separate hierarchies &amp; exchange directories — packages are separated from the rest of the file system, which will create less clutter and sources of conflict (such as from two packages providing a file with the same path and name)
<ul>
<li>Exchange directories may be global (such as <code>share</code>), so as to maintain compatibility with the <a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard">Filesystem Hierarchy Standard</a>, or inter-package, for situations where one package may act as a plugin for another one</li>
<li>A separate hierarchy for packages will also ensure that a user’s kernel &amp; userland remains untouched, reducing the risk of system failure</li>
</ul>
</li>
<li><a href="http://ftp.rpm.org/max-rpm/s1-rpm-inside-files-list-directives.html#S3-RPM-INSIDE-FLIST-GHOST-DIRECTIVE">Ghost files</a> — software often produces files during its use, such as log files, state files, index files, and the sort. Such files should remain associated with the software’s package so they can be removed along with the rest of the software</li>
</ul>
<h2>Considerations</h2>
<ul>
<li>Hooks and triggers
<ul>
<li>Without hooks or triggers, <a href="https://michael.stapelberg.ch/posts/2019-07-20-hooks-and-triggers/#hooks-preclude-concurrent-package-installation">concurrent package installation becomes much more possible</a>. Several major package managers <a href="https://michael.stapelberg.ch/posts/2019-08-17-linux-package-managers-are-slow/#current-landscape">only use post-install hooks</a>, and those can be <a href="https://src.fedoraproject.org/rpms/openssh/blob/30922f629cc135e3233e263d5e3eb346f9251c4e/f/sshd-keygen%40.service">replaced with services</a></li>
<li>While many would object to leaning on configuring an initialisation system instead of using hooks, particularly when many object with <code>systemd</code> as a whole (often due to its association with Lennart Poettering and <a href="http://0pointer.net/blog/revisiting-how-we-put-together-linux-systems.html">the philosophies of the <code>systemd</code> ‘cabal’ in general</a>), I must say that I largely agree with them—quite frankly, I don’t give a damn about how you (wrongly) feel about <code>systemd</code> being ‘bloated’ because the user experience will be improved by relying on it. If the notion of a system daemon scares you, then I don’t know how to even begin to approach you; unless you’re worried about some <a href="https://wiki.c2.com/?TheKenThompsonHack">Ken Thompson Bug</a>-type scenario where <code>systemd</code> could be exploited, then you cannot be arguing in good faith</li>
</ul>
</li>
<li>Archives or Images?
<ul>
<li>The best contender for an image format would be <a href="https://en.wikipedia.org/wiki/SquashFS">SquashFS</a>. Snap packages utilise it, and they <a href="https://forum.snapcraft.io/t/squashfs-performance-effect-on-snap-startup-time/13920">come with a decent performance hit</a>. While <a href="https://michael.stapelberg.ch/posts/2019-08-17-linux-package-managers-are-slow/#thought-experiment-further-speed-ups">using an archive would make package installation faster</a>, at the end of the day the user is going to care more about their system running slow than whether or not their packages install a tad bit faster</li>
<li>The <a href="https://en.wikipedia.org/wiki/LZ4_(compression_algorithm)">LZ4 algorithm</a> would provide the fastest decompression speeds available, ensuring the lowest decompression times possible during installation while also not sacrificing on the runtime performance of packaged software</li>
</ul>
</li>
</ul>

                    </div>
                </article>
            </main>

             <footer class="footer">
    <a class="footer_item" href="https://dirout.github.io/blog/feed.xml">rss</a>
    <span class="footer_item">&copy; 2021 Emil Sayahi & Evan Gabriel Burke</span>
    <small class="footer_copyright">
        <a href="https://github.com/dirout/blog" target="_blank" rel="noreferrer noopener">Mousehole</a>
    </small>
</footer>
<script src="https://dirout.github.io/blog/assets/js/main.js" defer="defer"></script>
        </div>
    </body>
</html>
